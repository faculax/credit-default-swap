# 🔍 Vulnerability Scanning Strategy

## Overview
This project uses a **multi-layered approach** to dependency vulnerability scanning, combining multiple tools and databases to ensure comprehensive coverage.

---

## 🛡️ Layer 1: OWASP Dependency Check (CI/CD)

### Current Configuration
We use OWASP Dependency Check with **alternative data sources** instead of the deprecated NVD JSON feeds.

### Enabled Analyzers:
1. **OSS Index (Sonatype)** ✅
   - Free vulnerability database
   - Covers Maven Central, npm, PyPI, and more
   - No API key required for CI/CD use
   - Rate limit: 120 requests/hour (sufficient for our needs)

2. **Central Analyzer** ✅
   - Analyzes Maven Central metadata
   - Identifies outdated dependencies
   - Works offline with cached data

3. **RetireJS** ✅
   - JavaScript library vulnerability detection
   - Covers npm packages and frontend dependencies

### Why Not NVD?
The National Vulnerability Database (NVD) deprecated their JSON 1.1 feeds in 2023. The new NVD API 2.0 requires:
- Free API key from https://nvd.nist.gov/developers/request-an-api-key
- Rate limiting (5 requests per 30 seconds without key, 50 with key)
- Additional configuration complexity

**Our decision:** Use OSS Index + Central Analyzer for now. Add NVD API key later if needed.

### Configuration Location:
```xml
<!-- backend/pom.xml, gateway/pom.xml, risk-engine/pom.xml -->
<plugin>
    <groupId>org.owasp</groupId>
    <artifactId>dependency-check-maven</artifactId>
    <configuration>
        <nvdDatafeedEnabled>false</nvdDatafeedEnabled>
        <ossindexAnalyzerEnabled>true</ossindexAnalyzerEnabled>
        <centralAnalyzerEnabled>true</centralAnalyzerEnabled>
        <retirejsAnalyzerEnabled>true</retirejsAnalyzerEnabled>
    </configuration>
</plugin>
```

---

## 🤖 Layer 2: GitHub Dependabot (Automated PRs)

### What It Does:
- **Scans all dependencies** daily for known vulnerabilities
- **Auto-generates PRs** to update vulnerable dependencies
- **Uses GitHub's vulnerability database** (aggregates from multiple sources including NVD)
- **Zero configuration** - just works with `.github/dependabot.yml`

### Coverage:
- ✅ Maven (backend, gateway, risk-engine)
- ✅ npm (frontend)
- ✅ GitHub Actions workflows

### Benefits:
- No manual intervention needed
- Proactive security updates
- Native GitHub integration
- Free for public and private repos

---

## 📊 Layer 3: SpotBugs + FindSecBugs (Static Analysis)

### What It Scans:
- **Bytecode analysis** of compiled Java code
- **Security patterns** (SQL injection, XSS, crypto issues)
- **Bug patterns** that could lead to vulnerabilities

### Runs On:
- Every push to any branch
- Parallel with OWASP scans

---

## 🎯 Layer 4: Custom Secrets Detection

### What It Catches:
- Hardcoded passwords in YAML/properties
- API keys in source code
- Database credentials in connection strings
- Secrets in ORE configuration files

### Workflow Integration:
- First job in security pipeline
- Blocks build if secrets found
- Educates developers on proper credential management

---

## 📈 Vulnerability Scan Results

### Where to Find Reports:

1. **OWASP Dependency Check**
   - Location: `target/dependency-check-report.html` (each service)
   - Uploaded as: GitHub Actions artifacts
   - CVSS Threshold: 7.0+ fails the build

2. **Dependabot Alerts**
   - Location: GitHub Security tab → Dependabot alerts
   - Auto-PRs: GitHub Pull Requests tab

3. **SpotBugs**
   - Location: `target/site/spotbugs.html` (each service)
   - Uploaded as: GitHub Actions artifacts

4. **Secrets Detection**
   - Location: GitHub Actions logs (Secrets Detection job)
   - Shows exact file and line number

---

## 🔧 How to Add NVD API Support (Future Enhancement)

If you want to enable the official NVD database:

### Step 1: Get API Key
1. Visit: https://nvd.nist.gov/developers/request-an-api-key
2. Request a free API key (instant approval)

### Step 2: Add to GitHub Secrets
1. Go to: Repository Settings → Secrets and variables → Actions
2. Add secret: `NVD_API_KEY` = your key

### Step 3: Update pom.xml
```xml
<configuration>
    <nvdDatafeedEnabled>false</nvdDatafeedEnabled>
    <nvdApiKeyEnvironmentVariable>NVD_API_KEY</nvdApiKeyEnvironmentVariable>
    <nvdApiDelay>6000</nvdApiDelay> <!-- 6 seconds between requests -->
</configuration>
```

### Step 4: Update workflow
```yaml
env:
  NVD_API_KEY: ${{ secrets.NVD_API_KEY }}
```

---

## ✅ Current Status

| Scanner | Status | Database | Coverage |
|---------|--------|----------|----------|
| OSS Index | ✅ Enabled | Sonatype | Maven, npm |
| Central Analyzer | ✅ Enabled | Maven Central | Java deps |
| RetireJS | ✅ Enabled | RetireJS DB | JavaScript |
| Dependabot | ✅ Enabled | GitHub | All langs |
| SpotBugs | ✅ Enabled | FindSecBugs | Java code |
| Secrets Detection | ✅ Enabled | Custom | Credentials |
| NVD API 2.0 | ⏸️ Disabled | NVD | All (optional) |

---

## 🎓 Best Practices

### For Developers:
1. **Never commit credentials** - use environment variables
2. **Review Dependabot PRs** weekly
3. **Check security reports** after each push
4. **Update dependencies** regularly (not just when vulnerabilities found)

### For CI/CD:
1. **Keep scanning fast** - OSS Index is faster than NVD
2. **Don't fail on low-severity** - only CVSS 7.0+
3. **Continue on error** for OWASP scan (don't block other scans)
4. **Upload artifacts** so reports persist

### For Production:
1. **Consider adding NVD API** for regulatory compliance
2. **Monitor Dependabot alerts** via email/Slack
3. **Track CVEs** in security dashboard
4. **Have remediation SLAs** (e.g., Critical = 24h, High = 7 days)

---

## 📞 Support & Resources

- **OWASP Dependency Check**: https://jeremylong.github.io/DependencyCheck/
- **OSS Index**: https://ossindex.sonatype.org/
- **NVD API**: https://nvd.nist.gov/developers
- **Dependabot**: https://docs.github.com/en/code-security/dependabot
- **FindSecBugs**: https://find-sec-bugs.github.io/

---

## 🚀 Quick Commands

Run dependency check locally:
```bash
# Backend
cd backend && ./mvnw dependency-check:check

# Gateway
cd gateway && ./mvnw dependency-check:check

# Risk Engine
cd risk-engine && ./mvnw dependency-check:check
```

View reports:
```bash
# Open HTML report (Windows)
start backend/target/dependency-check-report.html

# Open HTML report (Linux/Mac)
open backend/target/dependency-check-report.html
```

---

**Last Updated:** October 16, 2025  
**Configuration Version:** 1.0  
**Maintained By:** Security & DevOps Team
